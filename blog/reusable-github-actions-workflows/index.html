<!DOCTYPE html><!--VrLzuuVUyEwaVQIoVaFer--><html lang="en" data-theme="dark"><head><meta charSet="utf-8"/><link rel="preconnect" href="/" crossorigin=""/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/chunks/d43ab978ac5b76ce.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/chunks/85cdcd8c302669b0.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/c6108499b026e905.js"/><script src="/_next/static/chunks/82abf2d65f5428ae.js" async=""></script><script src="/_next/static/chunks/f2f58a7e93290fbb.js" async=""></script><script src="/_next/static/chunks/31674d9a34dac40b.js" async=""></script><script src="/_next/static/chunks/turbopack-bf9807f5d7365c2a.js" async=""></script><script src="/_next/static/chunks/9168958f931f481a.js" async=""></script><script src="/_next/static/chunks/ff1a16fafef87110.js" async=""></script><script src="/_next/static/chunks/d2be314c3ece3fbe.js" async=""></script><script src="/_next/static/chunks/5da3185e4c429326.js" async=""></script><link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&amp;family=JetBrains+Mono:wght@400;500;600;700&amp;display=swap" as="style"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/><title>Amar Sattaur | Staff DevOps &amp; Platform Engineer</title><meta name="description" content="Staff-level DevOps and Platform Engineer with deep expertise in Kubernetes orchestration, CI/CD pipeline architecture, and cloud infrastructure automation. Specializing in EKS, ArgoCD, Terraform, and cross-cloud migrations."/><meta name="author" content="Amar Sattaur"/><meta name="keywords" content="DevOps Engineer,Platform Engineer,Staff Engineer,Kubernetes,EKS,ArgoCD,Terraform,AWS,GCP,Oracle Cloud,CI/CD,Infrastructure,SRE,GitHub Actions"/><meta name="creator" content="Amar Sattaur"/><meta name="robots" content="index, follow"/><meta name="googlebot" content="index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1"/><link rel="canonical" href="https://jodybro.github.io/"/><meta property="og:title" content="Amar Sattaur | Staff DevOps &amp; Platform Engineer"/><meta property="og:description" content="Staff-level DevOps and Platform Engineer specializing in Kubernetes orchestration, CI/CD pipeline architecture, and cloud infrastructure automation."/><meta property="og:url" content="https://jodybro.github.io/"/><meta property="og:site_name" content="Amar Sattaur Portfolio"/><meta property="og:locale" content="en_US"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Amar Sattaur | Staff DevOps &amp; Platform Engineer"/><meta name="twitter:description" content="Staff-level DevOps and Platform Engineer specializing in Kubernetes orchestration, CI/CD pipeline architecture, and cloud infrastructure automation."/><link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&amp;family=JetBrains+Mono:wght@400;500;600;700&amp;display=swap" rel="stylesheet"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"Person","name":"Amar Sattaur","jobTitle":"Staff DevOps & Platform Engineer","description":"Staff-level DevOps and Platform Engineer specializing in Kubernetes orchestration, CI/CD pipeline architecture, and cloud infrastructure automation.","url":"https://jodybro.github.io","email":"ajodasattaur@gmail.com","sameAs":["https://github.com/jodybro","https://linkedin.com/in/amarsattaur"],"knowsAbout":["Kubernetes","Amazon EKS","Google GKE","ArgoCD","Terraform","GitHub Actions","CI/CD","DevOps","Platform Engineering","Cloud Infrastructure","AWS","GCP","Oracle Cloud"],"worksFor":{"@type":"Organization","name":"Mogo Financial"}}</script><script src="/_next/static/chunks/a6dad97d9634a72d.js" noModule=""></script></head><body><div hidden=""><!--$--><!--/$--></div><nav class="navbar navbar-expand-lg fixed-top"><div class="container"><a class="navbar-brand text-info" href="/"><i class="bi bi-terminal me-2"></i>amarsattaur</a><button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"><i class="bi bi-list text-light fs-4"></i></button><div class="collapse navbar-collapse" id="navbarNav"><ul class="navbar-nav ms-auto nav-compact"><li class="nav-item"><a class="nav-link " href="/#about">About</a></li><li class="nav-item"><a class="nav-link" href="/#experience">Experience</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle active" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">Content</a><ul class="dropdown-menu"><li><a class="dropdown-item" href="/blog/"><i class="bi bi-journal-text me-2"></i>Blog</a></li><li><a class="dropdown-item" href="/#case-studies"><i class="bi bi-briefcase me-2"></i>Case Studies</a></li></ul></li><li class="nav-item"><a class="nav-link " href="/incidents/">Incidents</a></li><li class="nav-item"><a class="nav-link" href="/#contact">Contact</a></li></ul><div class="search-container ms-lg-2 mt-3 mt-lg-0"><button class="btn nav-icon-btn" aria-label="Search"><i class="bi bi-search"></i></button></div><button class="btn nav-icon-btn ms-lg-2 mt-3 mt-lg-0" aria-label="Toggle theme"><i class="bi bi-sun"></i></button><div class="btn-group ms-lg-2 mt-3 mt-lg-0"><a class="btn btn-resume" href="/resume/"><i class="bi bi-file-earmark-text me-1"></i>Resume</a><button type="button" class="btn btn-resume dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" aria-expanded="false"><span class="visually-hidden">Toggle Dropdown</span></button><ul class="dropdown-menu dropdown-menu-end"><li><a class="dropdown-item" href="/Amar_Sattaur_Resume.pdf" download=""><i class="bi bi-download me-2"></i>Download</a></li></ul></div></div></div></nav><article class="py-5" style="padding-top:120px"><div class="container py-5"><div class="row"><div class="col-lg-8 mx-auto"><nav aria-label="breadcrumb" class="mb-4"><ol class="breadcrumb"><li class="breadcrumb-item"><a class="text-info" href="/">Home</a></li><li class="breadcrumb-item"><a class="text-info" href="/blog/">Blog</a></li><li class="breadcrumb-item active text-secondary">Production CI/CD</li></ol></nav><header class="mb-5"><div class="d-flex flex-wrap gap-2 mb-3"><button type="button" class="tech-badge tech-badge-clickable" aria-label="Add GitHub Actions to search filters" title="Click to search for GitHub Actions">GitHub Actions</button><button type="button" class="tech-badge tech-badge-clickable" aria-label="Add CI/CD to search filters" title="Click to search for CI/CD">CI/CD</button><button type="button" class="tech-badge tech-badge-clickable" aria-label="Add Helm to search filters" title="Click to search for Helm">Helm</button><button type="button" class="tech-badge tech-badge-clickable" aria-label="Add ArgoCD to search filters" title="Click to search for ArgoCD">ArgoCD</button><button type="button" class="tech-badge tech-badge-clickable" aria-label="Add Release Please to search filters" title="Click to search for Release Please">Release Please</button></div><h1 class="display-5 fw-bold mb-3">Building a Production-Ready CI/CD Pipeline with Reusable GitHub Actions</h1><div class="d-flex align-items-center text-secondary"><span>January 2025</span><span class="mx-2">•</span><span>15 min read</span></div></header><div class="blog-content"><p class="lead text-secondary mb-4">When your organization scales from a handful of services to 20+ microservices, copy-pasting CI/CD configurations becomes unsustainable. This post walks through a production-ready pipeline architecture that uses reusable workflows, environment-aware deployments, and GitOps integration with ArgoCD.</p><h2 class="h3 mt-5 mb-3 text-info">The Scenario</h2><p class="text-secondary">Imagine a growing fintech startup—let&#x27;s call them Acme Corp—that started with a monolith and gradually broke it into microservices. As the engineering team expanded, they faced common CI/CD challenges:</p><ul class="text-secondary"><li>Each team copied pipeline configs from existing repos, leading to drift</li><li>Inconsistent Helm chart naming conventions (hyphens vs underscores, casing issues)</li><li>No clear process for multi-environment deployments (dev, staging, prod)</li><li>Ad-hoc version bumping with no correlation to change significance</li><li>ArgoCD sync happening manually or with inconsistent automation</li></ul><p class="text-secondary">The solution? A centralized reusable workflow that handles the entire build-to-deploy lifecycle with a single tag push.</p><h2 class="h3 mt-5 mb-3 text-info">Architecture Overview</h2><p class="text-secondary">The pipeline uses a caller/callee pattern where individual service repos have minimal configuration, and a centralized workflow handles all the complexity.</p><div class="custom-card p-4 my-4"><h5 class="text-info mb-3"><i class="bi bi-diagram-3 me-2"></i>Pipeline Flow</h5><pre class="text-success mb-0" style="font-size:0.85rem">Developer pushes tag: deploy-staging-v1.2.3
                    ↓
┌─────────────────────────────────────────────────────────────────┐
│  Caller Workflow (service repo)                                  │
│  - Triggers on deploy-* tags                                    │
│  - Calls centralized reusable workflow                          │
└─────────────────────────────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────────────────────────────┐
│  Reusable Workflow (org/.github repo)                           │
│                                                                 │
│  Job 1: build          → Docker image + attestation             │
│         ↓                                                       │
│  Job 2: helm-push      → Normalize chart, auto-version, push    │
│         ↓                                                       │
│  Job 3: update-values  → Update env-specific values in deploy branch│
│         ↓                                                       │
│  Job 4: argocd-pr      → Create &amp; auto-merge PR to ArgoCD repo  │
└─────────────────────────────────────────────────────────────────┘
                    ↓
ArgoCD detects change → Syncs to Kubernetes cluster</pre></div><h2 class="h3 mt-5 mb-3 text-info">The Caller Workflow</h2><p class="text-secondary">Each service repository contains a minimal workflow file that delegates to the centralized workflow. The magic happens in the tag naming convention.</p><div class="terminal-card my-4"><div class="terminal-header"><div class="terminal-dot terminal-dot-red"></div><div class="terminal-dot terminal-dot-yellow"></div><div class="terminal-dot terminal-dot-green"></div><span class="ms-3 text-secondary small">.github/workflows/build-and-deploy.yml</span></div><div class="terminal-body"><pre class="text-success mb-0">name: Build-and-Deploy

on:
  push:
    tags:
      - &#x27;deploy-**&#x27;    # Matches: deploy-dev-v1.0.0, deploy-staging-release, etc.
      - &#x27;DEPLOY-**&#x27;    # Case-insensitive matching

jobs:
  build-and-deploy:
    uses: acme-corp/.github/.github/workflows/build-deploy-pipeline.yml@main
    secrets: inherit  # Pass all secrets to the reusable workflow</pre></div></div><p class="text-secondary">The tag format <code>deploy-<!-- -->{environment}<!-- -->-<!-- -->{identifier}</code> encodes the target environment directly in the trigger. This eliminates the need for environment selection UI or manual inputs.</p><h2 class="h3 mt-5 mb-3 text-info">Job 1: Docker Build with Attestation</h2><p class="text-secondary">The build job creates the Docker image with proper caching and supply chain security.</p><div class="terminal-card my-4"><div class="terminal-header"><div class="terminal-dot terminal-dot-red"></div><div class="terminal-dot terminal-dot-yellow"></div><div class="terminal-dot terminal-dot-green"></div><span class="ms-3 text-secondary small">Build Job</span></div><div class="terminal-body"><pre class="text-success mb-0">build:
  runs-on: ubuntu-latest
  concurrency:
    group: ${{ github.sha }}
    cancel-in-progress: false
  permissions:
    contents: read
    packages: write
    id-token: write
    attestations: write
  outputs:
    digest: ${{ steps.docker-build.outputs.digest }}
  steps:
    - uses: actions/checkout@v4

    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v3

    - name: Log into registry
      uses: docker/login-action@v3
      with:
        registry: ${{ env.REGISTRY }}
        username: ${{ secrets.REGISTRY_USERNAME }}
        password: ${{ secrets.REGISTRY_TOKEN }}

    - name: Build and Push Docker Image
      id: docker-build
      uses: docker/build-push-action@v6
      with:
        context: .
        push: true
        tags: ${{ env.IMAGE_NAME }}:${{ github.sha }}
        cache-from: type=gha
        cache-to: type=gha,mode=max

    - name: Attest container image
      uses: actions/attest-build-provenance@v2
      with:
        subject-name: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}
        subject-digest: ${{ steps.docker-build.outputs.digest }}
        push-to-registry: true</pre></div></div><h3 class="h5 mt-4 mb-3">Key Design Decisions</h3><ul class="text-secondary"><li><strong>Concurrency groups:</strong> Using <code>github.sha</code> prevents parallel runs for the same commit while allowing different commits to build simultaneously</li><li><strong>Build attestation:</strong> Creates a cryptographic proof of where and how the image was built—critical for supply chain security</li><li><strong>GHA cache:</strong> Leverages GitHub&#x27;s built-in caching for Docker layers, typically reducing build times by 40-60%</li></ul><h2 class="h3 mt-5 mb-3 text-info">Job 2: Helm Chart Normalization &amp; Push</h2><p class="text-secondary">This job handles one of the trickiest aspects of managing many microservices: keeping Helm chart conventions consistent. It normalizes chart names, detects the target environment from the tag, and auto-increments versions.</p><h3 class="h5 mt-4 mb-3">Environment Detection</h3><div class="terminal-card my-4"><div class="terminal-header"><div class="terminal-dot terminal-dot-red"></div><div class="terminal-dot terminal-dot-yellow"></div><div class="terminal-dot terminal-dot-green"></div><span class="ms-3 text-secondary small">Extract environment from tag</span></div><div class="terminal-body"><pre class="text-success mb-0">- name: Determine environment
  id: determine-env
  run: |
    # Tag format: deploy-{env}-{identifier}
    # Extract the environment (second segment)
    TARGET=$(echo $GITHUB_REF_NAME | cut -d &quot;-&quot; -f 2)

    # Validate it&#x27;s a known environment
    if [[ $TARGET == &quot;sandbox&quot; ]] || [[ $TARGET == &quot;dev&quot; ]] || \
       [[ $TARGET == &quot;qa&quot; ]] || [[ $TARGET == &quot;staging&quot; ]] || \
       [[ $TARGET == &quot;prod&quot; ]]; then
      echo &quot;ENVIRONMENT=$TARGET&quot; &gt;&gt; $GITHUB_OUTPUT
    else
      echo &quot;::error title=Invalid Environment::Unknown environment: $TARGET&quot;
      exit 1
    fi</pre></div></div><h3 class="h5 mt-4 mb-3">Chart Name Normalization</h3><p class="text-secondary">Over time, teams created charts with inconsistent naming: <code>my-service</code>, <code>My_Service</code>, <code>myService</code>. This step enforces a canonical format: lowercase with underscores.</p><div class="terminal-card my-4"><div class="terminal-header"><div class="terminal-dot terminal-dot-red"></div><div class="terminal-dot terminal-dot-yellow"></div><div class="terminal-dot terminal-dot-green"></div><span class="ms-3 text-secondary small">Normalize chart naming</span></div><div class="terminal-body"><pre class="text-success mb-0">- name: Normalize Helm chart directory and Chart.yaml name
  run: |
    # Canonical name: lowercase, hyphens → underscores
    REPO_NAME=&quot;${{ github.event.repository.name }}&quot;
    CANONICAL_CHART_NAME=$(echo &quot;$REPO_NAME&quot; \
      | tr &#x27;[:upper:]&#x27; &#x27;[:lower:]&#x27; \
      | sed &#x27;s/-/_/g&#x27;)
    CANONICAL_CHART_DIR=&quot;helm/${CANONICAL_CHART_NAME}&quot;

    # Find existing Chart.yaml
    CHART_FILE=$(find helm -maxdepth 2 -name &#x27;Chart.yaml&#x27; | head -n 1)
    CURRENT_CHART_DIR=$(dirname &quot;$CHART_FILE&quot;)

    # Rename directory if needed
    if [[ &quot;$CURRENT_CHART_DIR&quot; != &quot;$CANONICAL_CHART_DIR&quot; ]]; then
      git mv &quot;$CURRENT_CHART_DIR&quot; &quot;$CANONICAL_CHART_DIR&quot;
    fi

    # Update name field in Chart.yaml
    CURRENT_NAME=$(yq &#x27;.name&#x27; &quot;$CANONICAL_CHART_DIR/Chart.yaml&quot;)
    if [[ &quot;$CURRENT_NAME&quot; != &quot;$CANONICAL_CHART_NAME&quot; ]]; then
      yq -i &quot;.name = \&quot;$CANONICAL_CHART_NAME\&quot;&quot; &quot;$CANONICAL_CHART_DIR/Chart.yaml&quot;
    fi

    # Commit changes if any
    if ! git diff --cached --quiet; then
      git commit -m &quot;chore: normalize helm chart to canonical form&quot;
      git push origin HEAD:$GITHUB_REF_NAME
    fi</pre></div></div><h3 class="h5 mt-4 mb-3">Semantic Versioning with Release Please</h3><p class="text-secondary">Instead of using raw bash to auto-increment versions (which always bumps patch regardless of change type), we use <a href="https://github.com/googleapis/release-please" class="text-info" target="_blank" rel="noopener noreferrer">release-please</a> by Google. This tool analyzes your commit messages following <a href="https://www.conventionalcommits.org/" class="text-info" target="_blank" rel="noopener noreferrer">Conventional Commits</a> and automatically determines the appropriate semantic version bump.</p><h4 class="h6 mt-4 mb-2">Why Release Please?</h4><ul class="text-secondary"><li><strong>Semantic versioning done right:</strong> <code>feat:</code> commits bump minor, <code>fix:</code> bumps patch, <code>BREAKING CHANGE:</code> bumps major</li><li><strong>Automated changelogs:</strong> Generates CHANGELOG.md from commit messages</li><li><strong>Native Helm support:</strong> Understands Chart.yaml and updates versions automatically</li><li><strong>PR-based workflow:</strong> Creates release PRs that you can review before merging</li></ul><h4 class="h6 mt-4 mb-2">Configuration Files</h4><p class="text-secondary">Release Please requires two configuration files in your repository root:</p><div class="terminal-card my-4"><div class="terminal-header"><div class="terminal-dot terminal-dot-red"></div><div class="terminal-dot terminal-dot-yellow"></div><div class="terminal-dot terminal-dot-green"></div><span class="ms-3 text-secondary small">release-please-config.json</span></div><div class="terminal-body"><pre class="text-success mb-0">{
  &quot;packages&quot;: {
    &quot;charts/my_service&quot;: {
      &quot;release-type&quot;: &quot;helm&quot;,
      &quot;bump-minor-pre-major&quot;: true,
      &quot;bump-patch-for-minor-pre-major&quot;: false
    }
  },
  &quot;changelog-sections&quot;: [
    { &quot;type&quot;: &quot;feat&quot;, &quot;section&quot;: &quot;Features&quot; },
    { &quot;type&quot;: &quot;fix&quot;, &quot;section&quot;: &quot;Bug Fixes&quot; },
    { &quot;type&quot;: &quot;perf&quot;, &quot;section&quot;: &quot;Performance Improvements&quot; },
    { &quot;type&quot;: &quot;refactor&quot;, &quot;section&quot;: &quot;Code Refactoring&quot; },
    { &quot;type&quot;: &quot;docs&quot;, &quot;section&quot;: &quot;Documentation&quot; },
    { &quot;type&quot;: &quot;chore&quot;, &quot;hidden&quot;: true },
    { &quot;type&quot;: &quot;style&quot;, &quot;hidden&quot;: true },
    { &quot;type&quot;: &quot;test&quot;, &quot;hidden&quot;: true },
    { &quot;type&quot;: &quot;ci&quot;, &quot;hidden&quot;: true }
  ]
}</pre></div></div><div class="terminal-card my-4"><div class="terminal-header"><div class="terminal-dot terminal-dot-red"></div><div class="terminal-dot terminal-dot-yellow"></div><div class="terminal-dot terminal-dot-green"></div><span class="ms-3 text-secondary small">.release-please-manifest.json</span></div><div class="terminal-body"><pre class="text-success mb-0">{
  &quot;charts/my_service&quot;: &quot;1.3.0&quot;
}</pre></div></div><p class="text-secondary">The manifest file tracks the current version of each package. Release Please updates this automatically when releases are created.</p><h4 class="h6 mt-4 mb-2">Release Please Workflow</h4><p class="text-secondary">Add a dedicated workflow that runs on pushes to main. Release Please will analyze commits since the last release and either create a release PR or update an existing one.</p><div class="terminal-card my-4"><div class="terminal-header"><div class="terminal-dot terminal-dot-red"></div><div class="terminal-dot terminal-dot-yellow"></div><div class="terminal-dot terminal-dot-green"></div><span class="ms-3 text-secondary small">.github/workflows/release-please.yml</span></div><div class="terminal-body"><pre class="text-success mb-0">name: Release Please

on:
  push:
    branches:
      - main

permissions:
  contents: write
  pull-requests: write

jobs:
  release-please:
    name: Release Please
    runs-on: ubuntu-latest
    # Prevent infinite loops from release commits
    if: &quot;!contains(github.event.head_commit.message, &#x27;chore(main): release&#x27;)&quot;
    outputs:
      releases_created: ${{ steps.release.outputs.releases_created }}
      tag_name: ${{ steps.release.outputs.tag_name }}
    steps:
      - name: Run Release Please
        uses: googleapis/release-please-action@v4
        id: release
        with:
          token: ${{ secrets.GITHUB_TOKEN }}</pre></div></div><h4 class="h6 mt-4 mb-2">Helm Push (with Release Please)</h4><p class="text-secondary">The Helm push step now reads the version from Chart.yaml (which Release Please has already updated) instead of manually calculating version bumps.</p><div class="terminal-card my-4"><div class="terminal-header"><div class="terminal-dot terminal-dot-red"></div><div class="terminal-dot terminal-dot-yellow"></div><div class="terminal-dot terminal-dot-green"></div><span class="ms-3 text-secondary small">Helm Push step (simplified)</span></div><div class="terminal-body"><pre class="text-success mb-0">- name: Helm Push
  if: ${{ needs.release-please.outputs.releases_created }}
  run: |
    HELM_REGISTRY=&quot;ghcr.io/${{ github.repository_owner }}&quot;
    CHART_NAME=&quot;${{ steps.normalize.outputs.CHART_NAME }}&quot;
    ENVIRONMENT=&quot;${{ steps.determine-env.outputs.ENVIRONMENT }}&quot;

    # Login to GHCR
    echo &quot;${{ secrets.GITHUB_TOKEN }}&quot; | \
      helm registry login ghcr.io --username ${{ github.actor }} --password-stdin

    # Version is already set by Release Please in Chart.yaml
    CHART_VERSION=$(yq &#x27;.version&#x27; helm/$CHART_NAME/Chart.yaml)

    # Append environment to chart name for env-specific releases
    yq -i &quot;.name = .name + \&quot;-$ENVIRONMENT\&quot;&quot; helm/$CHART_NAME/Chart.yaml

    # Package and push
    helm package helm/$CHART_NAME
    helm push ${CHART_NAME}-${ENVIRONMENT}-${CHART_VERSION}.tgz $HELM_REGISTRY</pre></div></div><h4 class="h6 mt-4 mb-2">Conventional Commits in Practice</h4><p class="text-secondary">With Release Please, your commit messages drive versioning:</p><div class="terminal-card my-4"><div class="terminal-header"><div class="terminal-dot terminal-dot-red"></div><div class="terminal-dot terminal-dot-yellow"></div><div class="terminal-dot terminal-dot-green"></div><span class="ms-3 text-secondary small">Commit message examples</span></div><div class="terminal-body"><pre class="text-success mb-0"># Patch bump (1.3.0 → 1.3.1)
git commit -m &quot;fix: resolve null pointer in auth handler&quot;

# Minor bump (1.3.0 → 1.4.0)
git commit -m &quot;feat: add support for OAuth2 PKCE flow&quot;

# Major bump (1.3.0 → 2.0.0)
git commit -m &quot;feat!: redesign API response format

BREAKING CHANGE: Response now uses camelCase instead of snake_case&quot;</pre></div></div><h2 class="h3 mt-5 mb-3 text-info">Job 3: Update Environment Values</h2><p class="text-secondary">A dedicated <code>deploy</code> branch stores environment-specific values files. This separation allows different configurations per environment while keeping the main branch clean.</p><div class="terminal-card my-4"><div class="terminal-header"><div class="terminal-dot terminal-dot-red"></div><div class="terminal-dot terminal-dot-yellow"></div><div class="terminal-dot terminal-dot-green"></div><span class="ms-3 text-secondary small">Update environment values</span></div><div class="terminal-body"><pre class="text-success mb-0">update-env-values:
  needs: [build, helm-push]
  runs-on: ubuntu-latest
  env:
    environment: ${{ needs.helm-push.outputs.environment }}
    chart_version: ${{ needs.helm-push.outputs.chart_version }}
  steps:
    - uses: actions/checkout@v4
      with:
        ref: deploy  # Dedicated branch for env configs
        token: ${{ secrets.GH_TOKEN }}

    - name: Update values files
      run: |
        VALUES_FILE=&quot;helm/environment-values/values-${{ env.environment }}.yaml&quot;

        # Update commit tracking
        yq -i &#x27;.config.commit_id = &quot;${{ github.sha }}&quot;&#x27; &quot;$VALUES_FILE&quot;
        yq -i &#x27;.config.github_id = &quot;${{ github.actor }}&quot;&#x27; &quot;$VALUES_FILE&quot;

        # Update chart version
        CHART_FILE=&quot;helm/$CHART_NAME/Chart-${{ env.environment }}.yaml&quot;
        yq -i &#x27;.version = &quot;${{ env.chart_version }}&quot;&#x27; &quot;$CHART_FILE&quot;

    - name: Commit and push
      run: |
        git add .
        git commit -m &quot;Update ${{ env.environment }} values&quot;
        git push</pre></div></div><h2 class="h3 mt-5 mb-3 text-info">Job 4: ArgoCD Integration</h2><p class="text-secondary">The final job creates a PR to the ArgoCD repository, updating the <code>targetRevision</code> to the new chart version. The PR is automatically merged, triggering ArgoCD to sync.</p><div class="terminal-card my-4"><div class="terminal-header"><div class="terminal-dot terminal-dot-red"></div><div class="terminal-dot terminal-dot-yellow"></div><div class="terminal-dot terminal-dot-green"></div><span class="ms-3 text-secondary small">ArgoCD PR automation</span></div><div class="terminal-body"><pre class="text-success mb-0">update-chart-version:
  needs: [build, helm-push, update-env-values]
  runs-on: ubuntu-latest
  env:
    environment: ${{ needs.helm-push.outputs.environment }}
    chart_version: ${{ needs.helm-push.outputs.chart_version }}
    app_name: ${{ needs.helm-push.outputs.app_name }}
  steps:
    - uses: actions/checkout@v4
      with:
        repository: acme-corp/k8s-argocd
        path: tmp/argo
        token: ${{ secrets.GH_TOKEN }}

    - name: Update targetRevision
      run: |
        # Convert hyphens to underscores for YAML key
        APP_KEY=$(echo &quot;${{ env.app_name }}&quot; | tr &#x27;-&#x27; &#x27;_&#x27;)

        yq -i &quot;.${APP_KEY}.targetRevision = \&quot;${{ env.chart_version }}\&quot;&quot; \
          &quot;tmp/argo/apps-${{ env.environment }}/values.yaml&quot;

    - name: Create and merge PR
      working-directory: tmp/argo
      run: |
        BRANCH=&quot;${{ env.environment }}-${{ env.app_name }}-${{ env.chart_version }}&quot;

        git checkout -b $BRANCH
        git add .
        git commit -m &quot;chore: bump ${{ env.app_name }} to ${{ env.chart_version }}&quot;
        git push --set-upstream origin $BRANCH

        gh pr create \
          --title &quot;chore: Update ${{ env.app_name }} in ${{ env.environment }}&quot; \
          --body &quot;Automated chart version update&quot; \
          --base main

        # Auto-merge (requires branch protection rules allowing this)
        gh pr merge --delete-branch --merge</pre></div></div><h2 class="h3 mt-5 mb-3 text-info">Environment-Specific Chart Files</h2><p class="text-secondary">One powerful pattern is maintaining environment-specific Chart files (<code>Chart-dev.yaml</code>, <code>Chart-staging.yaml</code>, <code>Chart-prod.yaml</code>). This allows different versions, annotations, or dependencies per environment.</p><div class="terminal-card my-4"><div class="terminal-header"><div class="terminal-dot terminal-dot-red"></div><div class="terminal-dot terminal-dot-yellow"></div><div class="terminal-dot terminal-dot-green"></div><span class="ms-3 text-secondary small">Directory structure</span></div><div class="terminal-body"><pre class="text-success mb-0">helm/
├── my_service/
│   ├── Chart.yaml           # Base chart definition
│   ├── Chart-dev.yaml       # Dev environment overrides
│   ├── Chart-staging.yaml   # Staging environment overrides
│   ├── Chart-prod.yaml      # Prod environment overrides
│   ├── values.yaml          # Default values
│   └── templates/
└── environment-values/
    ├── values-dev.yaml      # Dev-specific values
    ├── values-staging.yaml  # Staging-specific values
    └── values-prod.yaml     # Prod-specific values</pre></div></div><h2 class="h3 mt-5 mb-3 text-info">Developer Experience</h2><p class="text-secondary">With this setup, deploying to any environment is a single command:</p><div class="terminal-card my-4"><div class="terminal-header"><div class="terminal-dot terminal-dot-red"></div><div class="terminal-dot terminal-dot-yellow"></div><div class="terminal-dot terminal-dot-green"></div><span class="ms-3 text-secondary small">Deployment commands</span></div><div class="terminal-body"><pre class="text-success mb-0"># Deploy to dev
git tag deploy-dev-$(date +%Y%m%d-%H%M%S)
git push origin --tags

# Deploy to staging
git tag deploy-staging-v1.2.3
git push origin --tags

# Deploy to production
git tag deploy-prod-release-2025-01
git push origin --tags</pre></div></div><h2 class="h3 mt-5 mb-3 text-info">Results</h2><div class="custom-card p-4 my-4"><div class="row text-center"><div class="col-md-3 mb-3 mb-md-0"><h3 class="text-info">18 → 1</h3><p class="text-secondary mb-0">Workflow files per repo</p></div><div class="col-md-3 mb-3 mb-md-0"><h3 class="text-info">45%</h3><p class="text-secondary mb-0">Faster deploys</p></div><div class="col-md-3 mb-3 mb-md-0"><h3 class="text-info">100%</h3><p class="text-secondary mb-0">Consistent chart naming</p></div><div class="col-md-3"><h3 class="text-info">0</h3><p class="text-secondary mb-0">Manual ArgoCD syncs</p></div></div></div><h2 class="h3 mt-5 mb-3 text-info">Key Takeaways</h2><ol class="text-secondary"><li><strong>Encode intent in triggers:</strong> Using tag naming conventions eliminates environment selection UI and reduces human error</li><li><strong>Normalize ruthlessly:</strong> Consistent naming conventions prevent drift and simplify tooling</li><li><strong>Use Release Please for versioning:</strong> Let commit messages drive semantic version bumps instead of brittle bash scripts</li><li><strong>Chain jobs with outputs:</strong> Pass data between jobs via outputs to create cohesive pipelines</li><li><strong>Use concurrency groups:</strong> Prevent race conditions when multiple deployments happen simultaneously</li><li><strong>Automate the entire path:</strong> From commit to ArgoCD sync, remove manual steps wherever possible</li></ol><h2 class="h3 mt-5 mb-3 text-info">Conclusion</h2><p class="text-secondary">Building a production-ready CI/CD pipeline isn&#x27;t about adding complexity—it&#x27;s about encoding best practices so teams can focus on shipping features. By centralizing workflow logic, enforcing conventions, and automating the entire deployment path, you create a system that scales with your organization.</p><p class="text-secondary">The initial investment in building this infrastructure pays dividends every time a new service is created or a deployment is triggered. What once took hours of setup and manual coordination now happens with a single <code>git push --tags</code>.</p><div class="custom-card p-4 mt-5"><div class="d-flex align-items-center"><div class="icon-box me-3" style="width:60px;height:60px"><i class="bi bi-person fs-3"></i></div><div><h5 class="mb-1">Amar Sattaur</h5><p class="text-secondary mb-0 small">Staff DevOps Engineer specializing in CI/CD automation, Kubernetes, and developer experience.</p></div></div></div><div class="d-flex justify-content-between mt-5 pt-4 border-top border-secondary"><a class="btn btn-outline-custom" href="/blog/zero-downtime-eks-upgrades/"><i class="bi bi-arrow-left me-2"></i>Previous Post</a><a class="btn btn-gradient" href="/blog/argocd-multi-cluster-patterns/">Next Post<i class="bi bi-arrow-right ms-2"></i></a></div></div></div></div></div></article><footer class="footer py-4"><div class="container"><div class="row align-items-center"><div class="col-md-6 text-center text-md-start mb-3 mb-md-0"><span class="text-secondary" style="font-family:monospace"><span class="text-info">&gt;</span> Built with Next.js &amp; Bootstrap</span></div><div class="col-md-6 text-center text-md-end"><span class="text-secondary" style="font-family:monospace">© <!-- -->2026<!-- --> <!-- -->Amar Sattaur</span></div></div></div></footer><!--$--><!--/$--><script src="/_next/static/chunks/c6108499b026e905.js" id="_R_" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[11414,[\"/_next/static/chunks/9168958f931f481a.js\"],\"default\"]\n3:I[39756,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/d2be314c3ece3fbe.js\"],\"default\"]\n4:I[37457,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/d2be314c3ece3fbe.js\"],\"default\"]\n5:I[47257,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/d2be314c3ece3fbe.js\"],\"ClientPageRoot\"]\n6:I[49255,[\"/_next/static/chunks/9168958f931f481a.js\",\"/_next/static/chunks/5da3185e4c429326.js\"],\"default\"]\n9:I[97367,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/d2be314c3ece3fbe.js\"],\"OutletBoundary\"]\na:\"$Sreact.suspense\"\nc:I[97367,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/d2be314c3ece3fbe.js\"],\"ViewportBoundary\"]\ne:I[97367,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/d2be314c3ece3fbe.js\"],\"MetadataBoundary\"]\n10:I[68027,[\"/_next/static/chunks/ff1a16fafef87110.js\",\"/_next/static/chunks/d2be314c3ece3fbe.js\"],\"default\"]\n:HL[\"/_next/static/chunks/d43ab978ac5b76ce.css\",\"style\"]\n:HL[\"/_next/static/chunks/85cdcd8c302669b0.css\",\"style\"]\n:HC[\"/\",\"\"]\n:HL[\"https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800\u0026family=JetBrains+Mono:wght@400;500;600;700\u0026display=swap\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"VrLzuuVUyEwaVQIoVaFer\",\"c\":[\"\",\"blog\",\"reusable-github-actions-workflows\",\"\"],\"q\":\"\",\"i\":false,\"f\":[[[\"\",{\"children\":[\"blog\",{\"children\":[\"reusable-github-actions-workflows\",{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/chunks/d43ab978ac5b76ce.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/chunks/85cdcd8c302669b0.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-0\",{\"src\":\"/_next/static/chunks/9168958f931f481a.js\",\"async\":true,\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"data-theme\":\"dark\",\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"link\",null,{\"rel\":\"preconnect\",\"href\":\"https://fonts.googleapis.com\"}],[\"$\",\"link\",null,{\"rel\":\"preconnect\",\"href\":\"https://fonts.gstatic.com\",\"crossOrigin\":\"anonymous\"}],[\"$\",\"link\",null,{\"href\":\"https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800\u0026family=JetBrains+Mono:wght@400;500;600;700\u0026display=swap\",\"rel\":\"stylesheet\"}],[\"$\",\"script\",null,{\"type\":\"application/ld+json\",\"dangerouslySetInnerHTML\":{\"__html\":\"{\\\"@context\\\":\\\"https://schema.org\\\",\\\"@type\\\":\\\"Person\\\",\\\"name\\\":\\\"Amar Sattaur\\\",\\\"jobTitle\\\":\\\"Staff DevOps \u0026 Platform Engineer\\\",\\\"description\\\":\\\"Staff-level DevOps and Platform Engineer specializing in Kubernetes orchestration, CI/CD pipeline architecture, and cloud infrastructure automation.\\\",\\\"url\\\":\\\"https://jodybro.github.io\\\",\\\"email\\\":\\\"ajodasattaur@gmail.com\\\",\\\"sameAs\\\":[\\\"https://github.com/jodybro\\\",\\\"https://linkedin.com/in/amarsattaur\\\"],\\\"knowsAbout\\\":[\\\"Kubernetes\\\",\\\"Amazon EKS\\\",\\\"Google GKE\\\",\\\"ArgoCD\\\",\\\"Terraform\\\",\\\"GitHub Actions\\\",\\\"CI/CD\\\",\\\"DevOps\\\",\\\"Platform Engineering\\\",\\\"Cloud Infrastructure\\\",\\\"AWS\\\",\\\"GCP\\\",\\\"Oracle Cloud\\\"],\\\"worksFor\\\":{\\\"@type\\\":\\\"Organization\\\",\\\"name\\\":\\\"Mogo Financial\\\"}}\"}}]]}],[\"$\",\"body\",null,{\"children\":[\"$\",\"$L2\",null,{\"children\":[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]}]]}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[[\"$\",\"$L5\",null,{\"Component\":\"$6\",\"serverProvidedParams\":{\"searchParams\":{},\"params\":{},\"promises\":[\"$@7\",\"$@8\"]}}],[[\"$\",\"script\",\"script-0\",{\"src\":\"/_next/static/chunks/5da3185e4c429326.js\",\"async\":true,\"nonce\":\"$undefined\"}]],[\"$\",\"$L9\",null,{\"children\":[\"$\",\"$a\",null,{\"name\":\"Next.MetadataOutlet\",\"children\":\"$@b\"}]}]]}],{},null,false,false]},null,false,false]},null,false,false]},null,false,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$Lc\",null,{\"children\":\"$Ld\"}],[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$Le\",null,{\"children\":[\"$\",\"$a\",null,{\"name\":\"Next.Metadata\",\"children\":\"$Lf\"}]}]}],null]}],false]],\"m\":\"$undefined\",\"G\":[\"$10\",[]],\"S\":true}\n"])</script><script>self.__next_f.push([1,"7:{}\n8:\"$0:f:0:1:1:children:1:children:1:children:0:props:children:0:props:serverProvidedParams:params\"\n"])</script><script>self.__next_f.push([1,"d:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"b:null\n"])</script><script>self.__next_f.push([1,"f:[[\"$\",\"title\",\"0\",{\"children\":\"Amar Sattaur | Staff DevOps \u0026 Platform Engineer\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"Staff-level DevOps and Platform Engineer with deep expertise in Kubernetes orchestration, CI/CD pipeline architecture, and cloud infrastructure automation. Specializing in EKS, ArgoCD, Terraform, and cross-cloud migrations.\"}],[\"$\",\"meta\",\"2\",{\"name\":\"author\",\"content\":\"Amar Sattaur\"}],[\"$\",\"meta\",\"3\",{\"name\":\"keywords\",\"content\":\"DevOps Engineer,Platform Engineer,Staff Engineer,Kubernetes,EKS,ArgoCD,Terraform,AWS,GCP,Oracle Cloud,CI/CD,Infrastructure,SRE,GitHub Actions\"}],[\"$\",\"meta\",\"4\",{\"name\":\"creator\",\"content\":\"Amar Sattaur\"}],[\"$\",\"meta\",\"5\",{\"name\":\"robots\",\"content\":\"index, follow\"}],[\"$\",\"meta\",\"6\",{\"name\":\"googlebot\",\"content\":\"index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1\"}],[\"$\",\"link\",\"7\",{\"rel\":\"canonical\",\"href\":\"https://jodybro.github.io/\"}],[\"$\",\"meta\",\"8\",{\"property\":\"og:title\",\"content\":\"Amar Sattaur | Staff DevOps \u0026 Platform Engineer\"}],[\"$\",\"meta\",\"9\",{\"property\":\"og:description\",\"content\":\"Staff-level DevOps and Platform Engineer specializing in Kubernetes orchestration, CI/CD pipeline architecture, and cloud infrastructure automation.\"}],[\"$\",\"meta\",\"10\",{\"property\":\"og:url\",\"content\":\"https://jodybro.github.io/\"}],[\"$\",\"meta\",\"11\",{\"property\":\"og:site_name\",\"content\":\"Amar Sattaur Portfolio\"}],[\"$\",\"meta\",\"12\",{\"property\":\"og:locale\",\"content\":\"en_US\"}],[\"$\",\"meta\",\"13\",{\"property\":\"og:type\",\"content\":\"website\"}],[\"$\",\"meta\",\"14\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"15\",{\"name\":\"twitter:title\",\"content\":\"Amar Sattaur | Staff DevOps \u0026 Platform Engineer\"}],[\"$\",\"meta\",\"16\",{\"name\":\"twitter:description\",\"content\":\"Staff-level DevOps and Platform Engineer specializing in Kubernetes orchestration, CI/CD pipeline architecture, and cloud infrastructure automation.\"}]]\n"])</script></body></html>